<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Lead X</title>
  <!-- sanf CDN -->
  <link href="https://fonts.cdnfonts.com/css/sf-pro-display" rel="stylesheet">
  
  <!-- Fonts CDN -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playwrite+DE+LA:wght@100..400&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
  <script src="https://kit.fontawesome.com/520b138994.js" crossorigin="anonymous"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  
  <!-- Excel CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.8.0/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
 
  <!-- PDF CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>
  
  <!-- Firebase -->
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
  <!-- style CSS-->
  <style >
@import url('https://fonts.cdnfonts.com/css/sf-pro-display');

.poppins-thin {
  font-family: "Poppins", sans-serif;
  font-weight: 100;
  font-style: normal;
}

.poppins-extralight {
  font-family: "Poppins", sans-serif;
  font-weight: 200;
  font-style: normal;
}

.poppins-light {
  font-family: "Poppins", sans-serif;
  font-weight: 300;
  font-style: normal;
}

.poppins-regular {
  font-family: "Poppins", sans-serif;
  font-weight: 400;
  font-style: normal;
}

.poppins-medium {
  font-family: "Poppins", sans-serif;
  font-weight: 500;
  font-style: normal;
}

.poppins-semibold {
  font-family: "Poppins", sans-serif;
  font-weight: 600;
  font-style: normal;
}

.poppins-bold {
  font-family: "Poppins", sans-serif;
  font-weight: 700;
  font-style: normal;
}

.poppins-extrabold {
  font-family: "Poppins", sans-serif;
  font-weight: 800;
  font-style: normal;
}

.poppins-black {
  font-family: "Poppins", sans-serif;
  font-weight: 900;
  font-style: normal;
}

.poppins-thin-italic {
  font-family: "Poppins", sans-serif;
  font-weight: 100;
  font-style: italic;
}

.poppins-extralight-italic {
  font-family: "Poppins", sans-serif;
  font-weight: 200;
  font-style: italic;
}

.poppins-light-italic {
  font-family: "Poppins", sans-serif;
  font-weight: 300;
  font-style: italic;
}

.poppins-regular-italic {
  font-family: "Poppins", sans-serif;
  font-weight: 400;
  font-style: italic;
}

.poppins-medium-italic {
  font-family: "Poppins", sans-serif;
  font-weight: 500;
  font-style: italic;
}

.poppins-semibold-italic {
  font-family: "Poppins", sans-serif;
  font-weight: 600;
  font-style: italic;
}

.poppins-bold-italic {
  font-family: "Poppins", sans-serif;
  font-weight: 700;
  font-style: italic;
}

.poppins-extrabold-italic {
  font-family: "Poppins", sans-serif;
  font-weight: 800;
  font-style: italic;
}

.poppins-black-italic {
  font-family: "Poppins", sans-serif;
  font-weight: 900;
  font-style: italic;
}

* {
  font-family: "Poppins", sans-serif;
  margin: 0px;
  padding: 0px;
  box-sizing: border-box;
  transition: 0.4s ease;
}
body {
  font-size: 12px;
  background: #f4f4f4;
  color: #333;
  transition: background 0.3s, color 0.3s;
}
.dark-mode {
  background: #1e1e1e;
  color: #fff;
}
.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1.5rem 1.4rem;
  background: #ffffff8f;
  backdrop-filter: blur(25px);
  border-bottom: 3px dotted #787878;
  position: sticky;
  top: 0;
  z-index: 900;
  font-size: 20px:
  
}
.dark-mode .header,
.dark-mode .controls,
.dark-mode .stats {
  background: #0000008f;
  backdrop-filter: blur(25px);
}

.toggle {
  width: 50px;
  height: 24px;
  background: #ccc;
  border-radius: 20px;
  position: relative;
  cursor: pointer;
}
.toggle::after {
  content: "";
  width: 22px;
  height: 22px;
  background: #444;
  position: absolute;
  top: 1px;
  left: 1px;
  border-radius: 50%;
  transition: 0.3s;
}
.dark .toggle::after {
  left: 27px;
  background: #fff;
}

.stats {
  display: flex;
  justify-content: space-around;
  padding: 1rem;
  background: #ffffff8f;
  backdrop-filter: blur(25px);
  border-bottom: 1px solid #ccc;
  position: sticky;
  top: 81px; /* Adjust based on .header height */
  z-index: 900;
}
.stat-box {
  text-align: center;
}
.stat-box span {
  display: block;
  font-weight: bold;
  font-size: 1rem;
}
.stat-total {
  color: #007bff;
}
.stat-open {
  color: #e60000;
}
.stat-closed {
  color: #009900;
}

.controls {
  display: flex;
  justify-content: space-between;
  padding: 0.5rem 1rem;
  background: #ffffff8f;
  backdrop-filter: blur(25px);
  position: sticky;
  top: 160px; /* Adjust based on combined height of .header + .stats */
  z-index: 900;
  border-bottom: 2px dotted #7e7e7e;
}
.controls input {
  background: #f6f6f6;
  outline: none;
}
.dark-mode .controls input {
  background: #383838;
  color: white;
}
.dark-mode thead th {
  background: #2b2b2b;
}
button {
  padding: 0.5rem 1rem;
  border: none;
  background: #007bff;
  color: white;
  border-radius: 50px;
  cursor: pointer;
  font-size: 14px;
}

.table-container {
  padding: 5px 15px;
}
table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0 12px; /* Spacing between rows */
  background: transparent;
}
thead th {
  text-align: left;
  font-size: 13px;
  padding: 0.1rem 1rem;
  font-weight: bold;
  background: white;
  position: sticky;
  top: 218px; /* Adjust based on combined height above */
  z-index: 900;
}
tbody tr {
  background: white;
  border-radius: 12px;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
  overflow: hidden;
}
.dark-mode tbody tr {
  background: #2b2b2b;
  box-shadow: 0 2px 6px rgba(255, 255, 255, 0.05);
}
td {
  padding: 0.75rem;
  vertical-align: top;
}

.status-open,
.status-closed {
  padding: 5px 10px;
  border-radius: 12px;
  color: white;
  font-weight: 500;
  cursor: pointer;
  display: inline-block;
  width: 70px;
  text-align: center;
}
.status-open {
  background: #e60000;
}
.status-closed {
  background: #009900;
}

.comment-line {
  font-size: 12px;
  color: #555;
  padding: 8px 12px 12px 12px;
  background: rgba(0, 0, 0, 0.03);
  border-radius: 0 0 12px 12px;
  margin-top: -10px;
}
.dark-mode .comment-line {
  color: #aaa;
  background: rgba(255, 255, 255, 0.05);
}

/* Modal Styles */
.modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  backdrop-filter: blur(3px);
  background-color: #ffffff32;
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 900;
}
.modal-content {
  background: white;
  padding: 1rem;
  border-radius: 10px;
  width: 90%;
  max-width: 400px;
}
.modal-content input,
.modal-content select,
.modal-content textarea {
  width: 100%;
  margin-bottom: 10px;
  padding: 8px;
  font-size: 14px;
}
.modal-content textarea {
  resize: vertical;
}

.dark-mode .modal-content {
  background: #333;
  color: white;
}
.dark-mode .modal-content input,
.dark-mode .modal-content select,
.dark-mode .modal-content textarea {
  background: #444;
  color: white;
  border: none;
}
.lead-card {
  display: flex;
  flex-direction: column;
  gap: 5px;
  font-size: 12px;
  padding: 2px;
}

.lead-row {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr 1fr;
  align-items: center;
  gap: 10px;
}

.lead-col {
  text-align: left;
  overflow-wrap: break-word;
}
.comment {
  font-size: 12px;
  color: #666;
  background: #bdbdbd16;
  padding: 4px 8px;
  border-radius: 7px;
}
.dark-mode .comment {
  color: #aaa;
  background: rgba(255, 255, 255, 0.05);
}
.cardinter {
  border-radius: 15px;
}
.theme-btn {
  border-radius: 10px;
  font-size: 20px;
}
.fa-location-arrow {
  font-size: 25px;
  color: #ffc700;
}
.dark-mode .fa-location-arrow {
  color: #d47100;
}
.footer-content {
  font-size: 26px;
  padding: 25px;
  color: #d3d3d3;
}
footer {
  height: 200px;
}
.dark-mode .location-popup {
  background: #424242;
  color: white;
}
.location-popup {
  position: absolute;
  top: 80px; /* adjust based on your header height */
  right: 20px; /* align near your location icon */
  background: #ffffffe0;
  backdrop-filter: blur(10px);
  border-radius: 25px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.4);
  color: black;
  padding: 20px 30px;
  font-weight: bold;
  font-size: 17px;
  z-index: 999;
  
  width: 90%;
  min-height: 130px;
  max-height: auto;
}

.location-popup .menu-item {
  padding: 8px;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 8px;
}

.hidden {
  display: none;
}
a, a:visited, a:hover, a:active {
  color: inherit;
  text-decoration: none;
}
.auth-btn {
  display: none;
}
.loginOverlay{
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  backdrop-filter: blur(10px);
  background: #00000067;
  z-index: 9999;
}
.loginCard{
    background: white;
    color: black;
    border-radius: 20px;
    padding: 30px;
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
    text-align: auto;
    max-width: 340px;
    width: 100%;
    font-family: 'Poppins', sans-serif;
}
.loginBtn{
      background: white;
      color: black;
      border: 1px solid #9e9e9e;
      padding: 12px 15px;
      font-size: 16px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      cursor: pointer;
      width: 100%;
      margin: 30px 0px;
}
    .adsbtom{
      max-width: 100vw;
    }
</style>
</head>
<body>
    <div id="login-overlay" class="loginOverlay">
      <div id="login-card" class="loginCard">
        <h2>Lead<span style="color: #00c0ff;">X</span></h2>
        <h1 style="font-size: 35px;">Login account</h1>
        <p style="color: gray;">Welcome back, login to continue.</p>
         <button onclick="googleLogin()" class="loginBtn">
          <img src="https://cdn-icons-png.flaticon.com/512/2991/2991148.png" alt="Google Icon" style="width: 23px;" />Login with Google
         </button>
  </div>
</div>
    <!-- HEADER -->
    <div class="header">
  <!-- Left side: location icon + user profile -->
  <div style="display: flex; align-items: center; gap: 12px;">
    <div onclick="toggleMenu()">
      <i class="fas fa-bars" style="font-size:21px;"></i>
    </div>
    <div id="user-profile" style="display: none; align-items: center; gap: 8px;">
      <img id="profile-pic"
     src=""
     alt="Profile"
     style="width: 32px; height: 32px; border-radius: 50%;"
     onerror="this.onerror=null; this.src='https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRIwoYUmRwwk60oQVwIEFkoOn5iQZ1jNYkMh80kZ5KkIauzp7E-4kCAkvw&s=10';" />
       <div class="name">
           <p style="opacity: 90%; color: #818181;">Welcome,</p>
           <span id="user-name" style="font-size: 14px; font-weight: 500;"></span>
       </div>
   </div>
  </div>

  <!-- Right side: dark mode toggle -->
  <div id="theme-toggle" class="theme-btn">
    <i class="far fa-moon"></i>
  </div>
</div>
        <!-- HEADER STATS BOX -->
        <div class="stats">
            <div class="stat-box">
                <span class="stat-total">Total Lead</span>
                <span id="total-count">0</span>
            </div>
            <div class="stat-box">
                <span class="stat-open">Open Lead</span>
                <span id="open-count">0</span>
            </div>
            <div class="stat-box">
                <span class="stat-closed">Closed Lead</span>
                <span id="closed-count">0</span>
            </div>
        </div>
        <!-- HEADER ACTION BUTTONS -->
        <div class="controls">
            <button onclick="openLeadForm()">Add Lead</button>
            <input type="text" id="search-input" placeholder="Search lead..." oninput="filterLeads()" style="padding: 8px 12px; font-size: 14px; border-radius: 6px; border: 1px solid #ccc; width: 200px;">
        </div>
        <!-- LEAD BOX -->
        <div class="table-container">
            <table id="lead-table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Phone</th>
                        <th>Product</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>

        <!-- Modal -->
        <div class="modal" id="leadModal">
            <div class="modal-content">
                <input type="text" id="lead-name" placeholder="Name" />
                <input type="text" id="lead-phone" placeholder="Phone" />
                <input type="text" id="lead-product" placeholder="Product" />
                <select id="lead-status">
                    <option value="Open">Open</option>
                    <option value="Closed">Closed</option>
                </select>
                <textarea id="lead-comment" rows="3" placeholder="Comment (optional)"></textarea>
                <button onclick="saveLead()">Generate Lead</button>
                <button onclick="deleteLead()" id="delete-btn" style="background: #e60000;">Delete Lead</button>
            </div>
        </div>

        <!-- MENU BOX -->
        <div id="locationMenu" class="location-popup hidden">
            <div class="menu-item" onclick="exportToExcel()">
                <i class="fas fa-file-excel"></i> Export to Excel
            </div>
            <div class="menu-item" onclick="exportToPDF()">
                <i class="fas fa-file-pdf"></i> Export to Pdf
            </div>
          <div class="menu-item"">
                <i class="fas fa-database"></i><a href="sales.html"> Add Sales Data </a>
          </div>
          <div class="menu-item"">
                <button onclick="logout()" class="auth-btn">Logout</button>
                <button onclick="googleLogin()" class="auth-btn">Login with Google</button>

          </div>
        </div>
    </div>
    
    <!-- FOOTER START -->
    
    <footer>
        <div class="footer-content">
            <h1>Made With Love <i class="fas fa-heart"></i></h1>
        </div>
    </footer>
    
    <!-- FOOTER ENDS -->
  <div class="adsbtom">
    <script type="text/javascript"> atOptions = {'key' : 'af41ed77bb9af6db5381e4d0ca7a031a',	'format' : 'iframe',	'height' : 60,'width' : auto,'params' : {}	};</script>
    <script type="text/javascript" src="//www.highperformanceformat.com/af41ed77bb9af6db5381e4d0ca7a031a/invoke.js"></script>
  </div> 
    <!-- SCRIPT START -->

<script type="module">
 // ✅ Firebase SDK imports
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import {
  getAuth,
  GoogleAuthProvider,
  signInWithPopup,
  signOut
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import {
  getFirestore,
  collection,
  addDoc,
  doc,
  getDocs,
  updateDoc,
  deleteDoc,
  query,
  orderBy
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

// ✅ Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyCmpkVaoKl1UbXsSiU_ZVP3Tn-xn8yW_xc",
  authDomain: "lead-x-7c1f4.firebaseapp.com",
  projectId: "lead-x-7c1f4",
  storageBucket: "lead-x-7c1f4.firebasestorage.app",
  messagingSenderId: "76689287089",
  appId: "1:76689287089:web:3eda5283a47d8702a87f90"
};

// ✅ Initialize Firebase
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const provider = new GoogleAuthProvider();
const db = getFirestore(app);

// Global variables
let currentUser = null;
let userId = null;
let editLeadId = null;

// ✅ Login function
window.googleLogin = async function () {
  try {
    const result = await signInWithPopup(auth, provider);
    const user = result.user;

    localStorage.setItem("user", JSON.stringify(user));
    currentUser = user;
    userId = user.uid;

    // ✅ Show profile info
    const profilePic = document.getElementById("profile-pic");
const userName = document.getElementById("user-name");
const profileBox = document.getElementById("user-profile");

if (profilePic && userName && profileBox) {
  profilePic.src = user.photoURL || "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRIwoYUmRwwk60oQVwIEFkoOn5iQZ1jNYkMh80kZ5KkIauzp7E-4kCAkvw&s=10";
  userName.textContent = user.displayName;
  profileBox.style.display = "flex";
}

    document.getElementById("login-overlay").style.display = "none";
    toggleAuthButtons(true);
    renderLeads();
  } catch (error) {
    alert("Login Failed: " + error.message);
    toggleAuthButtons(false);
  }
};


// ✅ Logout function
window.logout = async function () {
  await signOut(auth);
  localStorage.removeItem("user");
  location.reload(); // refresh page
};

// ✅ Toggle login/logout buttons
function toggleAuthButtons(loggedIn) {
  const loginBtn = document.querySelector('button[onclick="googleLogin()"]');
  const logoutBtn = document.querySelector('button[onclick="logout()"]');
  loginBtn.style.display = loggedIn ? "none" : "inline-block";
  logoutBtn.style.display = loggedIn ? "inline-block" : "none";
}

// ✅ Open modal to add/edit lead
window.openLeadForm = function (id = null, lead = null) {
  editLeadId = id;
  const modal = document.getElementById("leadModal");
  modal.style.display = "flex";

  document.getElementById("lead-name").value = lead?.name || "";
  document.getElementById("lead-phone").value = lead?.phone || "";
  document.getElementById("lead-product").value = lead?.product || "";
  document.getElementById("lead-status").value = lead?.status || "Open";
  document.getElementById("lead-comment").value = lead?.comment || "";
  document.getElementById("delete-btn").style.display = id ? "inline-block" : "none";
};

// ✅ Close modal
window.closeModal = function () {
  document.getElementById("leadModal").style.display = "none";
};

// ✅ Save lead to Firestore
window.saveLead = async function () {
  const name = document.getElementById("lead-name").value.trim();
  const phone = document.getElementById("lead-phone").value.trim();
  const product = document.getElementById("lead-product").value.trim();
  const status = document.getElementById("lead-status").value;
  const comment = document.getElementById("lead-comment").value.trim();

  if (!name || !phone || !product) {
    alert("Please fill all fields.");
    return;
  }

  const leadData = { name, phone, product, status, comment, timestamp: Date.now() };
  const ref = collection(db, "users", userId, "leads");

  try {
    if (editLeadId) {
      const docRef = doc(db, "users", userId, "leads", editLeadId);
      await updateDoc(docRef, leadData);
      alert("Lead updated!");
    } else {
      await addDoc(ref, leadData);
      alert("Lead saved!");
    }
    renderLeads();
    closeModal();
  } catch (err) {
    alert("Error: " + err.message);
  }
};

// ✅ Delete lead
window.deleteLead = async function () {
  if (!editLeadId) return;
  if (!confirm("Delete this lead?")) return;

  try {
    const docRef = doc(db, "users", userId, "leads", editLeadId);
    await deleteDoc(docRef);
    alert("Lead deleted!");
    renderLeads();
    closeModal();
  } catch (err) {
    alert("Error deleting lead.");
  }
};

// ✅ Render all leads from Firestore
window.renderLeads = async function () {
  const tbody = document.querySelector("#lead-table tbody");
  tbody.innerHTML = "";

  const q = query(collection(db, "users", userId, "leads"), orderBy("timestamp", "desc"));
  const snapshot = await getDocs(q);

  let open = 0,
    closed = 0;

  snapshot.forEach((docSnap) => {
    const lead = docSnap.data();
    const id = docSnap.id;

    if (lead.status === "Open") open++;
    else closed++;

    const row = document.createElement("tr");
    row.innerHTML = `
      <td colspan="4" class="cardinter">
        <div class="lead-card">
          <div class="lead-row">
            <div class="lead-col name"><strong>${lead.name}</strong></div>
            <div class="lead-col phone">${lead.phone}</div>
            <div class="lead-col product">${lead.product}</div>
            <div class="lead-col status">
              <span class="status-${lead.status.toLowerCase()}" onclick="openLeadForm('${id}', ${JSON.stringify(lead).replace(/"/g, '&quot;')})">${lead.status}</span>
            </div>
          </div>
          ${lead.comment ? `<div class="comment">${lead.comment}</div>` : ""}
        </div>
      </td>
    `;
    tbody.appendChild(row);
  });

  document.getElementById("total-count").textContent = open + closed;
  document.getElementById("open-count").textContent = open;
  document.getElementById("closed-count").textContent = closed;
};

// ✅ Page Load: Check login & render leads
window.onload = async () => {
  const storedUser = localStorage.getItem("user");

  if (storedUser) {
  currentUser = JSON.parse(storedUser);
  userId = currentUser.uid;

  toggleAuthButtons(true);
  renderLeads();

  // ✅ Restore profile
  const profilePic = document.getElementById("profile-pic");
const userName = document.getElementById("user-name");
const profileBox = document.getElementById("user-profile");

if (profilePic && userName && profileBox) {
  profilePic.src = currentUser.photoURL || "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRIwoYUmRwwk60oQVwIEFkoOn5iQZ1jNYkMh80kZ5KkIauzp7E-4kCAkvw&s=10";
  userName.textContent = currentUser.displayName;
  profileBox.style.display = "flex";
}

  document.getElementById("login-overlay").style.display = "none";
}

  // Close modal if clicked outside
  window.addEventListener("click", (e) => {
    if (e.target === document.getElementById("leadModal")) {
      closeModal();
    }
  });
};


          // ✅ Theme toggle logic


const themeToggle = document.getElementById("theme-toggle");
themeToggle.addEventListener("click", () => {
  document.body.classList.toggle("dark-mode");
  localStorage.setItem("darkMode", document.body.classList.contains("dark-mode"));
});

         // ✅ Load stored theme preference on page load

if (localStorage.getItem("darkMode") === "true") {
  document.body.classList.add("dark-mode");
}

           // ✅ Show/hide location menu
           
window.toggleMenu = () => {
  const menu = document.getElementById("locationMenu");
  menu.classList.toggle("hidden");
};

          // ✅ search function 
 
window.filterLeads = () => {
  const searchTerm = document.getElementById("search-input").value.toLowerCase();
  const rows = document.querySelectorAll("#lead-table tbody tr");

  rows.forEach((row) => {
    const text = row.textContent.toLowerCase();
    row.style.display = text.includes(searchTerm) ? "" : "none";
  });
};


         // ✅ Export to excell
         
window.exportToExcel = async () => {
  if (!userId || !currentUser) {
    alert("Please login first.");
    return;
  }

  const wb = XLSX.utils.book_new();

  // ✅ Collect lead data
  const leadData = [["Name", "Phone", "Product", "Status", "Comment"]];

  const leadsRef = collection(db, "users", userId, "leads");
  const q = query(leadsRef, orderBy("timestamp", "desc"));
  const snapshot = await getDocs(q);

  snapshot.forEach((docSnap) => {
    const lead = docSnap.data();
    leadData.push([
      lead.name || "",
      lead.phone || "",
      lead.product || "",
      lead.status || "",
      lead.comment || ""
    ]);
  });

  if (leadData.length === 1) {
    alert("No leads found to export.");
    return;
  }

  // ✅ Append user info at the end
  leadData.push([]);
  leadData.push([`Exported by: ${currentUser.displayName || "N/A"}`]);
  leadData.push([`Email: ${currentUser.email || "N/A"}`]);
  leadData.push([`Exported on: ${new Date().toLocaleString()}`]);

  // ✅ Create worksheet and export
  const ws = XLSX.utils.aoa_to_sheet(leadData);
  XLSX.utils.book_append_sheet(wb, ws, "Leads");
  XLSX.writeFile(wb, `Leads_${currentUser.displayName.replace(/\s/g, "_")}.xlsx`);
};


            
            
               // ✅ Export to Pdf
     
     
     
     
window.exportToPDF = async () => {
  if (!userId || !currentUser) {
    alert("Please login first.");
    return;
  }

  const leadsRef = collection(db, "users", userId, "leads");
  const q = query(leadsRef, orderBy("timestamp", "desc"));
  const snapshot = await getDocs(q);

  const rows = [];

  snapshot.forEach((docSnap) => {
    const lead = docSnap.data();
    rows.push([
      lead.name || "",
      lead.phone || "",
      lead.product || "",
      lead.status || "",
      lead.comment || ""
    ]);
  });

  if (rows.length === 0) {
    alert("No leads found to export.");
    return;
  }

  // ✅ Set up jsPDF and autoTable
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  doc.setFontSize(14);
  doc.text("Lead Export", 14, 15);

  doc.autoTable({
    head: [["Name", "Phone", "Product", "Status", "Comment"]],
    body: rows,
    startY: 20,
    styles: { fontSize: 10, cellPadding: 1 },
    headStyles: { fillColor: [240, 240, 240], textColor: 20 },
  });

  // ✅ Add user info below table
  const exportY = doc.lastAutoTable.finalY + 10;
  doc.setFontSize(10);
  doc.text(`Exported by: ${currentUser.displayName || "N/A"}`, 14, exportY);
  doc.text(`Email: ${currentUser.email || "N/A"}`, 14, exportY + 6);
  doc.text(`Date: ${new Date().toLocaleString()}`, 14, exportY + 12);

  // ✅ Save PDF
  doc.save(`Leads_${currentUser.displayName.replace(/\s/g, "_")}.pdf`);
};

</script>
</body>
</html>
